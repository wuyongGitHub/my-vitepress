"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue");;/* empty css                */const G=require("../../_virtual/_plugin-vue_export-helper.js"),I={class:"heatmap-container"},P={class:"coordinates"},J={key:0,class:"controls"},K={class:"data-info"},Q={key:1,class:"legend"},U=Object.assign({name:"HeatMap2D"},{__name:"HeatMap2D",props:{width:{type:Number,default:612},height:{type:Number,default:831},blockWidth:{type:Number,default:36},blockHeight:{type:Number,default:36},refreshTrigger:{type:[Number,String,Boolean],default:null},showControls:{type:Boolean,default:!1},showLegend:{type:Boolean,default:!1},heatmapData:{type:Array,default:()=>[]}},setup(X){const n=X,p=e.ref(n.width?n.width:0),m=e.ref(n.height),h=e.ref(n.blockWidth),d=e.ref(n.blockHeight),w=e.ref(null);let y=null;const i=e.ref(0),v=e.ref(0),u=e.ref([]),V=e.ref(0),S=e.ref(0),s=e.reactive({visible:!1,x:0,y:0,col:0,row:0,value:0,rawX:0,rawY:0});let C=!1;const x=[{threshold:.1,color:"#08315f"},{threshold:.2,color:"#4588bb"},{threshold:.3,color:"#85bee3"},{threshold:.4,color:"#bedcf4"},{threshold:.5,color:"#e4d7dc"},{threshold:.6,color:"#fcdfda"},{threshold:.7,color:"#f9b6a2"},{threshold:.8,color:"#f97860"},{threshold:.9,color:"#c81626"},{threshold:1,color:"#af000f"}];e.watch(()=>n.heatmapData,t=>{u.value=t,g()},{deep:!0});function Y(t,l){if(l===0)return"transparent";const a=t/l;for(let o of x)if(a<=o.threshold)return o.color;return x[x.length-1].color}const R=e.computed(()=>{var l;let t=0;for(let a=0;a<v.value;a++)for(let o=0;o<i.value;o++)((l=u.value[a])==null?void 0:l[o])>0&&t++;return t}),_=e.computed(()=>{var l;let t=0;for(let a=0;a<v.value;a++)for(let o=0;o<i.value;o++){const r=((l=u.value[a])==null?void 0:l[o])||0;r>t&&(t=r)}return t}),W=e.computed(()=>{var a;let t=0,l=0;for(let o=0;o<v.value;o++)for(let r=0;r<i.value;r++){const c=((a=u.value[o])==null?void 0:a[r])||0;c>0&&(t+=c,l++)}return l>0?t/l:0});function H(){i.value=Math.ceil(p.value/h.value),v.value=Math.ceil(m.value/d.value)}function q(){u.value=Array(v.value).fill().map(()=>Array(i.value).fill(0))}function g(){var t;if(y){y.clearRect(0,0,p.value,m.value);for(let l=0;l<v.value;l++)for(let a=0;a<i.value;a++){const o=((t=u.value[l])==null?void 0:t[a])||0;if(o>0){const r=a*h.value,c=l*d.value;y.fillStyle=Y(o,_.value),y.fillRect(r,c,h.value,d.value)}}}}function k(t,l,a,o){for(let r=0;r<v.value;r++)for(let c=0;c<i.value;c++){const f=c*h.value+h.value/2,N=r*d.value+d.value/2,D=Math.sqrt((f-t)**2+(N-l)**2);if(D<a){const E=o*(1-D/a);u.value[r][c]=Math.max(u.value[r][c],Math.floor(E))}}}function z(t,l,a,o){const r=Math.floor(t/h.value),c=Math.floor(l/d.value),f=Math.ceil(a/Math.max(h.value,d.value)),N=Math.max(0,r-f),D=Math.min(i.value-1,r+f),E=Math.max(0,c-f),$=Math.min(v.value-1,c+f);for(let M=E;M<=$;M++)for(let b=N;b<=D;b++){const j=Math.sqrt((b-r)**2+(M-c)**2)*Math.max(h.value,d.value);if(j<a){const F=o*(1-j/a);u.value[M][b]=Math.max(u.value[M][b],Math.floor(F))}}g()}function T(){for(let t=0;t<v.value;t++)for(let l=0;l<i.value;l++)u.value[t][l]=Math.random()<.1?Math.floor(Math.random()*100):0;g()}function A(){B(),k(.1*p.value,.1*m.value,50,90),k(.3*p.value,.2*m.value,40,80),k(.2*p.value,.5*m.value,60,95),g()}function B(){u.value.forEach(t=>t.fill(0)),g()}function L(t){var f;const l=w.value.getBoundingClientRect(),a=t.clientX-l.left,o=t.clientY-l.top;V.value=Math.floor(a),S.value=Math.floor(o);const r=Math.floor(a/h.value),c=Math.floor(o/d.value);r>=0&&r<i.value&&c>=0&&c<v.value?(s.visible=!0,s.col=r,s.row=c,s.value=((f=u.value[c])==null?void 0:f[r])||0,s.rawX=a,s.rawY=o,s.x=t.clientX+15,s.y=t.clientY-30):s.visible=!1,C&&z(a,o,15,60)}function O(){C=!1,s.visible=!1}return e.onMounted(()=>{const t=w.value;t.width=n.width,t.height=n.height,y=t.getContext("2d"),H(),n.heatmapData&&n.heatmapData.length>0?u.value=n.heatmapData:q(),g()}),e.watch(()=>[n.width,n.height,n.blockWidth,n.blockHeight],()=>{p.value=n.width,m.value=n.height,h.value=n.blockWidth,d.value=n.blockHeight,e.nextTick(()=>{const t=w.value;t&&(t.width=p.value,t.height=m.value,y=t.getContext("2d"),H(),g())})}),e.watch(()=>n.refreshTrigger,()=>{n.refreshTrigger!==null&&g()}),(t,l)=>(e.openBlock(),e.createElementBlock("div",I,[e.createElementVNode("div",{class:"canvas-wrapper",style:e.normalizeStyle({width:`${p.value}px`,height:`${m.value}px`})},[e.createElementVNode("canvas",{ref_key:"heatmapCanvas",ref:w,onMousemove:L,onMouseleave:O,onContextmenu:l[0]||(l[0]=e.withModifiers(()=>{},["prevent"]))},null,544),e.createElementVNode("div",P,"X: "+e.toDisplayString(V.value)+", Y: "+e.toDisplayString(S.value),1),e.createElementVNode("div",{class:e.normalizeClass(["tooltip",{show:s.visible}]),style:e.normalizeStyle({left:s.x+"px",top:s.y+"px"})},[l[1]||(l[1]=e.createElementVNode("h3",null,"热力块信息",-1)),e.createElementVNode("p",null,"位置: ("+e.toDisplayString(s.col)+", "+e.toDisplayString(s.row)+")",1),e.createElementVNode("p",null,"值: "+e.toDisplayString(s.value),1),e.createElementVNode("p",null,"坐标: ("+e.toDisplayString(Math.floor(s.rawX))+", "+e.toDisplayString(Math.floor(s.rawY))+")",1)],6)],4),n.showControls?(e.openBlock(),e.createElementBlock("div",J,[e.createElementVNode("div",K," 尺寸: "+e.toDisplayString(i.value)+" × "+e.toDisplayString(v.value)+" (共 "+e.toDisplayString(i.value*v.value)+" 块)｜ 活跃块: "+e.toDisplayString(R.value)+"｜ 最大值: "+e.toDisplayString(_.value)+"｜ 平均值: "+e.toDisplayString(W.value.toFixed(2)),1),e.createElementVNode("div",{class:"btn-group"},[e.createElementVNode("button",{onClick:T},"随机数据"),e.createElementVNode("button",{onClick:A},"重置"),e.createElementVNode("button",{onClick:B},"清除")])])):e.createCommentVNode("",!0),n.showLegend?(e.openBlock(),e.createElementBlock("div",Q,[...l[2]||(l[2]=[e.createElementVNode("div",{class:"color-scale"},null,-1),e.createElementVNode("div",{class:"color-labels"},[e.createElementVNode("span",null,"低"),e.createElementVNode("span",null,"高")],-1)])])):e.createCommentVNode("",!0)]))}}),Z=G.default(U,[["__scopeId","data-v-fa92eb4d"]]);exports.default=Z;
