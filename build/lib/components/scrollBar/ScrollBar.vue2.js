"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),$=require("../../utils/tool.js"),I=require("./Bar.vue.js"),B=require("./type.js"),Z=t.defineComponent({name:"BqScrollBar",__name:"ScrollBar",props:{thumbWrapperSize:{default:6},autoHide:{type:[Boolean,Object],default:!0},barMinSize:{default:16}},emits:["scroll"],setup(L,{expose:M,emit:j}){const q=L,{thumbWrapperSize:h,autoHide:D,barMinSize:m}=t.toRefs(q),k=j,i=t.ref(),c=t.ref(),a=t.ref(),u=t.ref(),d=t.ref(),W=t.ref(),E=t.ref(0),v=t.ref(0),y=t.reactive({x:!1,y:!1}),n=t.reactive({width:0,height:0}),s=t.reactive({x:0,y:0}),R=t.reactive({x:0,y:0}),f=t.ref(0),p=t.ref(0);let x=null,w=null;const V=e=>{if(k("scroll",e),i.value&&e.target){let l=e.target,r=((l.scrollHeight-i.value.clientHeight)/(i.value.clientHeight-n.height)).toFixed(2),o=((l.scrollWidth-i.value.clientWidth)/(i.value.clientWidth-n.width)).toFixed(2),g=Number((l.scrollTop/Number(r)).toFixed(2)),b=Number((l.scrollLeft/Number(o)).toFixed(2));Object.assign(R,{x:Number(o),y:Number(r)}),Object.assign(s,{y:g<=0?0:g,x:b<=0?0:b})}},H=(e,l)=>{var r;if(W.value=l,l===B.DIRECTION_ENUM.VERTICAL){if(u.value&&u.value.barRef){let o=(r=u.value.barRef)==null?void 0:r.getBoundingClientRect();v.value=e.clientY-o.top,O(e)}}else if(d.value&&d.value.barRef){let o=d.value.barRef.getBoundingClientRect();v.value=e.clientX-o.left,O(e)}},O=e=>{e.stopPropagation(),document.addEventListener("mousemove",_),document.addEventListener("mouseup",z),document.onselectstart=()=>!1},_=e=>{if(W.value===B.DIRECTION_ENUM.VERTICAL){if(c.value&&u.value){let l=c.value.getBoundingClientRect(),r=(e.clientY-l.top-v.value)*R.y;i.value&&(i.value.scrollTop=r<=0?0:r)}}else if(c.value&&d.value){let l=c.value.getBoundingClientRect(),r=(e.clientX-l.left-v.value)*R.x;i.value&&(i.value.scrollLeft=r<=0?0:r)}},z=()=>{v.value=0,document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",z)},X=()=>{var l,r;let e=i.value;if(e&&c.value){let o=(e==null?void 0:e.clientWidth)*((e==null?void 0:e.clientWidth)/(e==null?void 0:e.scrollWidth)),g=(e==null?void 0:e.clientHeight)*((e==null?void 0:e.clientHeight)/(e==null?void 0:e.scrollHeight)),b=((e.scrollHeight-e.clientHeight)/(e.clientHeight-n.height)).toFixed(2),A=((e.scrollWidth-e.clientWidth)/(e.clientWidth-n.width)).toFixed(2);Object.assign(R,{x:Number(A),y:Number(b)}),Object.assign(n,{width:o<m.value?m.value:o,height:g<m.value?m.value:g}),p.value=(e==null?void 0:e.clientWidth)===(e==null?void 0:e.scrollWidth)?0:N("x")?1:0,f.value=(e==null?void 0:e.clientHeight)===(e==null?void 0:e.scrollHeight)?0:N("y")?1:0}e&&a.value&&Object.assign(y,{x:((l=a.value)==null?void 0:l.scrollWidth)>(e==null?void 0:e.clientWidth),y:((r=a.value)==null?void 0:r.scrollHeight)>(e==null?void 0:e.clientHeight)})},S=()=>{var l,r;let e=i.value;e&&a.value&&Object.assign(y,{x:((l=a.value)==null?void 0:l.clientWidth)>(e==null?void 0:e.clientWidth),y:((r=a.value)==null?void 0:r.clientHeight)>(e==null?void 0:e.clientHeight)}),C()},T=new ResizeObserver(e=>{C()}),C=$.debounced(()=>{X()},300),N=e=>{let l=D.value;return l instanceof Object?l[e]:l},Y=()=>{x&&(clearTimeout(x),x=null),f.value!==1&&(f.value=1),x=setTimeout(()=>{f.value=0},3e3)},F=()=>{w&&(clearTimeout(w),w=null),p.value!==1&&(p.value=1),w=setTimeout(()=>{p.value=0},3e3)};M({view:t.shallowRef(i)}),t.onMounted(async()=>{{let e=await Promise.resolve().then(()=>require("./generateBar.js"));E.value=e.getScrollBarWidth,a.value&&T.observe(a.value),window.addEventListener("resize",S),S()}}),t.onUnmounted(()=>{window.removeEventListener("resize",S),a.value&&T.unobserve(a.value)}),t.watch(()=>s.x,()=>{s.x!==0&&!N("x")&&F()},{deep:!0}),t.watch(()=>s.y,()=>{s.y!==0&&!N("y")&&Y()},{deep:!0});const P=t.computed(()=>({className:"right-scroll",thumbWrapperSize:h.value,showCoord:y,domRef:void 0,handleThumbClick:H,direction:B.DIRECTION_ENUM.VERTICAL,styleObj:{"--size":h.value+"px",transform:`translateY(${s.y}px)`,height:n.height+"px",opacity:t.unref(f)}})),U=t.computed(()=>({className:"bottom-scroll",thumbWrapperSize:h.value,showCoord:y,direction:B.DIRECTION_ENUM.HORIZONTAL,handleThumbClick:H,styleObj:{"--size":h.value+"px",transform:`translateX(${s.x}px)`,width:n.width+"px",opacity:t.unref(p)}}));return(e,l)=>(t.openBlock(),t.createElementBlock("div",{class:"bq-scrollbar",ref_key:"wrapperRef",ref:c},[t.createElementVNode("div",{onScroll:V,className:"bq-scrollbar-view_wrap",ref_key:"domRef",ref:i,style:t.normalizeStyle({"--size":t.unref(E)+"px"})},[t.createElementVNode("div",{className:"bq-scrollbar_view",ref_key:"viewBarRef",ref:a},[t.renderSlot(e.$slots,"default",{},void 0,!0)],512)],36),t.createVNode(I.default,t.mergeProps(t.unref(P),{ref_key:"rightBarRef",ref:u}),null,16),t.createVNode(I.default,t.mergeProps(t.unref(U),{ref_key:"bottomBarRef",ref:d}),null,16)],512))}});exports.default=Z;
