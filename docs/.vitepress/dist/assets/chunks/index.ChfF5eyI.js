const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/OrbitControls.DfyDYf8j.js","assets/chunks/three.module.CjLKN4l_.js"])))=>i.map(i=>d[i]);
import{_ as le}from"./Button.B7dY0lcR.js";import{d as ee,p as D,v as ce,V as ue,x as de,c as P,e as fe,j as te,k as j,N as K,o as T,_ as me,G as Q,w as pe,a as he}from"./framework.Gi3K-aNU.js";import{O as we,S as ge,e as _,P as ye,W as _e,f as be,D as Me,G as xe,g as ve,h as Ae,R as He,i as Ce,j as ze,c as Se,k as Be,M as Z}from"./three.module.CjLKN4l_.js";import{w as De}from"./tool.D1yyrI_Z.js";const Ee=["innerHTML"],Ge=ee({name:"JBHeatMap3D",__name:"HeatMap",props:{data:{type:Array,default:()=>[]},width:{type:Number,default:600},height:{type:Number,default:500},baseSize:{type:Number,default:.1},maxHeight:{type:Number,default:3},enableOrbit:{type:Boolean,default:!0},backgroundColor:{type:String,default:"#0d1b2a"},showGridHelper:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},isStandardColor:{type:Boolean,default:!0},rotateAnimation:{type:Boolean,default:!1},rotationSpeed:{type:Number,default:.01},autoAnimate:{type:Boolean,default:!1},cameraPosition:{type:Object,default:()=>({x:5,y:5,z:5})}},setup(k,{expose:V}){const E=D(0),t=k;new we;const x=D(null),b=D({show:!1,x:0,y:0,content:""}),z=D(t.autoAnimate);let d,c,f,w=null,g,S,u,B=null,H=[],a=0,m=0;ce(async()=>{const{OrbitControls:o}=await ue(async()=>{const{OrbitControls:e}=await import("./OrbitControls.DfyDYf8j.js");return{OrbitControls:e}},__vite__mapDeps([0,1]));N(),t.enableOrbit&&(w=new o(c,f.domElement),w.enableDamping=!0,w.dampingFactor=.05),X(),window.addEventListener("mousemove",W),window.addEventListener("resize",q),x.value&&x.value.addEventListener("mouseleave",()=>{b.value.show=!1})}),de(()=>{B&&cancelAnimationFrame(B),window.removeEventListener("mousemove",W),window.removeEventListener("resize",q),f.dispose()});function N(){const{backgroundColor:o,showGridHelper:e,showAxesHelper:s,cameraPosition:l}=t;d=new ge,d.background=new _(o),c=new ye(75,t.width/t.height,.1,1e3),c.position.set(l.x,l.y,l.z),f=new _e({antialias:!0}),f.setSize(t.width,t.height),f.shadowMap.enabled=!0,x.value&&x.value.appendChild(f.domElement),t.enableOrbit&&w&&(w.enableDamping=!0,w.dampingFactor=.05),d.add(new be(16777215,.6));const n=new Me(16777215,.8);if(n.position.set(10,20,5),d.add(n),g=new xe,d.add(g),e){const y=Math.max(a,m)*t.baseSize*1.2,r=new ve(y,Math.max(a,m),4473924,2236962);d.add(r)}if(s){const y=new Ae(Math.max(a,m)*t.baseSize*.6);d.add(y)}S=new He,u=new Ce,$()}function ae(o=10,e=10){return Array.from({length:o},()=>Array.from({length:e},()=>Math.random()*15+1))}function Y(o,e,s,l,n,y){let r=.1;n!==l&&(r+=(s-l)/(n-l)*t.maxHeight);const p=new ze(t.baseSize,r,t.baseSize,1,8,1),G=p.attributes.position,L=p.attributes.normal,J=[],v=n!==l?(s-l)/(n-l):0,M=[new _(536927),new _(4556987),new _(8765155),new _(12508404),new _(14997468),new _(16572378),new _(16365218),new _(16349280),new _(13112870),new _(11468815)];let i=[],h=0;v>=.9?(h=10,i=M.slice(0,10)):v>=.8?(h=9,i=M.slice(0,9)):v>=.7?(h=8,i=M.slice(0,8)):v>=.6?(h=7,i=M.slice(0,7)):v>=.5?(h=6,i=M.slice(0,6)):v>=.4?(h=5,i=M.slice(0,5)):v>=.3?(h=4,i=M.slice(0,4)):v>=.2?(h=3,i=M.slice(0,3)):v>=.1?(h=2,i=M.slice(0,2)):(h=1,i=M.slice(0,1));for(let O=0;O<G.count;O++){const re=G.getY(O),ie=L.getY(O);let C=new _;const U=Math.max(0,Math.min(1,(re+r/2)/r));if(ie>.5)C.copy(i[i.length-1]);else if(h===1)C.copy(i[0]);else{const I=1/(h-1);let A=Math.floor(U/I);A=Math.min(A,h-2),A=Math.max(0,A);const se=(U-A*I)/I;A>=0&&A+1<i.length?C.lerpColors(i[A],i[A+1],se):C.copy(i[i.length-1])}J.push(C.r,C.g,C.b)}p.setAttribute("color",new Se(new Float32Array(J),3));const oe=new Be({vertexColors:!0}),F=new Z(p,oe);return F.position.set((o-(a-1)/2)*t.baseSize,r/2,(e-(m-1)/2)*t.baseSize),F.userData={value:s,x:o,z:e},F}function ne(){{const{children:o}=g;o.forEach(e=>{e instanceof Z&&(e.geometry.dispose(),(Array.isArray(e.material)?e.material:[e.material]).forEach(l=>l.dispose()))}),g.clear()}}function $(){var l;if(ne(),Array.isArray(t.data)&&t.data.length>0&&t.data.every(n=>Array.isArray(n))?H=t.data.map(n=>[...n]):(console.log("数据不合法，使用默认数据"),H=ae()),g.clear(),a=H.length,m=((l=H[0])==null?void 0:l.length)||0,a===0||m===0){console.warn("数据为空，无法创建热力图");return}let e=1/0,s=-1/0;for(let n=0;n<a;n++){const y=H[n];if(Array.isArray(y))for(let r=0;r<m;r++){const p=y[r];typeof p=="number"&&(p<e&&(e=p),p>s&&(s=p))}}e===1/0&&(e=0),s===-1/0&&(s=0);for(let n=0;n<a;n++){const y=H[n];if(Array.isArray(y))for(let r=0;r<m;r++){const p=y[r],G=typeof p=="number"?p:0;let L=null;t.isStandardColor,L=Y(n,r,G,e,s),g.add(L)}}}function X(){B=requestAnimationFrame(X),t.rotateAnimation&&(E.value+=t.rotationSpeed,g.rotation.y=E.value),w&&w.update(),f.render(d,c)}let R=null;function W(o){if(!x.value)return;const e=x.value.getBoundingClientRect();if(o.clientX<e.left||o.clientX>e.right||o.clientY<e.top||o.clientY>e.bottom){b.value.show=!1;return}R&&cancelAnimationFrame(R),R=requestAnimationFrame(()=>{u.x=(o.clientX-e.left)/e.width*2-1,u.y=-((o.clientY-e.top)/e.height)*2+1,S.setFromCamera(u,c);const s=S.intersectObjects(g.children);if(s.length){const l=s[0].object,{value:n,x:y,z:r}=l.userData;b.value={show:!0,x:o.clientX-e.left+10,y:o.clientY-e.top-30,content:`数值: ${n.toFixed(2)}<br>位置: (${y}, ${r})`}}else b.value.show=!1})}function q(){c.aspect=t.width/t.height,c.updateProjectionMatrix(),f.setSize(t.width,t.height)}return V({refresh:$,toggleAnimation:()=>z.value=!z.value}),(o,e)=>(T(),P("div",{class:"heatmap-wrapper",style:K({width:k.width+"px",height:k.height+"px"})},[j(b).show?(T(),P("div",{key:0,class:"tooltip",style:K({left:j(b).x+"px",top:j(b).y+"px"}),innerHTML:j(b).content},null,12,Ee)):fe("",!0),te("div",{ref_key:"containerRef",ref:x,class:"three-container"},null,512)],4))}}),Le=me(Ge,[["__scopeId","data-v-02dfa60c"]]),je={style:{"margin-top":"10px"}},ke=ee({name:"JBHeatMap",__name:"BasicsHeatMap",setup(k){const V=D(null);function E(z,d){const c=z*d,f=Math.round(c*.02),w=Math.round(c*.2),g=Math.round(c*.3),S=c-f-w-g;console.log({total:c,"40-50":f,"20-30":w,"10-20":g,"1-5":S});const u=[];for(let a=0;a<f;a++)u.push(Math.floor(Math.random()*11)+40);for(let a=0;a<w;a++)u.push(Math.floor(Math.random()*11)+20);for(let a=0;a<g;a++)u.push(Math.floor(Math.random()*11)+10);for(let a=0;a<S;a++)u.push(Math.floor(Math.random()*5)+1);for(let a=u.length-1;a>0;a--){const m=Math.floor(Math.random()*(a+1));[u[a],u[m]]=[u[m],u[a]]}const B=[];let H=0;for(let a=0;a<z;a++){const m=[];for(let N=0;N<d;N++)m.push(u[H++]);B.push(m)}return B}const t=D(E(50,100));function x(){t.value=E(50,100),V.value.refresh()}function b(){console.log("热力图已刷新")}return(z,d)=>{const c=Le,f=le;return T(),P("div",null,[Q(c,{ref_key:"heatmap3D",ref:V,cameraPosition:{x:18,y:18,z:0},data:j(t),width:"675",height:"475","base-size":"0.5","max-height":"5","auto-animate":!0,onRefresh:b},null,8,["data"]),te("div",je,[Q(f,{onClick:x},{default:pe(()=>[...d[0]||(d[0]=[he("刷新热力图数据",-1)])]),_:1})])])}}}),Fe=De(ke);export{Fe as WYHeatMap};
