const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/OrbitControls.DfyDYf8j.js","assets/chunks/three.module.CjLKN4l_.js"])))=>i.map(i=>d[i]);
import{_ as ne}from"./Button.B7dY0lcR.js";import{d as U,p as B,v as re,V as se,x as ie,c as N,e as le,j as K,k as D,N as W,o as I,_ as ce,G as q,w as ue,a as fe}from"./framework.Gi3K-aNU.js";import{S as de,e as H,P as pe,W as me,f as he,D as ye,G as we,g as ge,h as _e,O as be,R as xe,i as Me,j as ve,c as Ae,k as Ce,M as J}from"./three.module.CjLKN4l_.js";import{w as He}from"./tool.D1yyrI_Z.js";const ze=["innerHTML"],De=U({name:"JBHeatMap3D",__name:"HeatMap",props:{data:{type:Array,default:()=>[]},width:{type:Number,default:600},height:{type:Number,default:500},baseSize:{type:Number,default:.1},maxHeight:{type:Number,default:3},enableOrbit:{type:Boolean,default:!0},backgroundColor:{type:String,default:"#0d1b2a"},showGridHelper:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},gradientColors:{type:Array,default:()=>["#9b30ff","#00ffff","#ffff00","#ff0000"]},autoAnimate:{type:Boolean,default:!1},cameraPosition:{type:Object,default:()=>({x:5,y:5,z:5})}},setup(E,{expose:S}){const o=E,x=B(null),M=B({show:!1,x:0,y:0,content:""}),z=B(o.autoAnimate);let y,m,i,u=null,_,v,A,f=null,d=[],b=0,t=0;re(async()=>{const{OrbitControls:a}=await se(async()=>{const{OrbitControls:e}=await import("./OrbitControls.DfyDYf8j.js");return{OrbitControls:e}},__vite__mapDeps([0,1]));C(),o.enableOrbit&&(u=new a(m,i.domElement),u.enableDamping=!0,u.dampingFactor=.05),Y(),window.addEventListener("mousemove",T),window.addEventListener("resize",$),x.value&&x.value.addEventListener("mouseleave",()=>{M.value.show=!1})}),ie(()=>{f&&cancelAnimationFrame(f),window.removeEventListener("mousemove",T),window.removeEventListener("resize",$),i.dispose()});function C(){const{backgroundColor:a,showGridHelper:e,showAxesHelper:l,cameraPosition:c}=o;y=new de,y.background=new H(a),m=new pe(75,o.width/o.height,.1,1e3),m.position.set(c.x,c.y,c.z),i=new me({antialias:!0}),i.setSize(o.width,o.height),i.shadowMap.enabled=!0,x.value&&x.value.appendChild(i.domElement),o.enableOrbit&&u&&(u.enableDamping=!0,u.dampingFactor=.05),y.add(new he(16777215,.6));const r=new ye(16777215,.8);if(r.position.set(10,20,5),y.add(r),_=new we,y.add(_),e){const w=Math.max(b,t)*o.baseSize*1.2,s=new ge(w,Math.max(b,t),4473924,2236962);y.add(s)}if(l){const w=new _e(Math.max(b,t)*o.baseSize*.6);y.add(w)}v=new xe,A=new Me,P()}function j(a=10,e=10){return Array.from({length:a},()=>Array.from({length:e},()=>Math.random()*15+1))}function Q(a,e,l,c,r,w){const s=.1+(l-c)/(r-c)*o.maxHeight,h=new ve(o.baseSize,s,o.baseSize,1,8,1),V=h.attributes.position,O=h.attributes.normal,X=[],R=(l-c)/(r-c),G=[new H(139),new H(65535),new H(16776960),new H(16711680)];let n=[];R>=.75?n=[...G]:R>=.5?n=G.slice(0,3):R>=.25?n=G.slice(0,2):n=G.slice(0,1);for(let k=0;k<V.count;k++){const ae=V.getY(k),oe=O.getY(k);let p=new H;const g=(ae+s/2)/s;oe>.5?p.copy(n[n.length-1]):n.length===4?g<.25?p.lerpColors(n[0],n[1],g/.25):g<.5?p.lerpColors(n[1],n[2],(g-.25)/.25):g<.75?p.lerpColors(n[2],n[3],(g-.5)/.25):p.copy(n[3]):n.length===3?g<.33?p.lerpColors(n[0],n[1],g/.33):g<.66?p.lerpColors(n[1],n[2],(g-.33)/.33):p.copy(n[2]):n.length===2?g<.5?p.lerpColors(n[0],n[1],g/.5):p.copy(n[1]):p.copy(n[0]),X.push(p.r,p.g,p.b)}h.setAttribute("color",new Ae(new Float32Array(X),3));const te=new Ce({vertexColors:!0}),F=new J(h,te);return F.position.set((a-(b-1)/2)*o.baseSize,s/2,(e-(t-1)/2)*o.baseSize),F.userData={value:l,x:a,z:e},F}new be;function Z(){{const{children:a}=_;a.forEach(e=>{e instanceof J&&(e.geometry.dispose(),(Array.isArray(e.material)?e.material:[e.material]).forEach(c=>c.dispose()))}),_.clear()}}function P(){var c;if(Z(),console.log("createHeatmap 调用，props.data =",o.data),Array.isArray(o.data)&&o.data.length>0&&o.data.every(r=>Array.isArray(r))?d=o.data:(console.log("数据不合法，使用默认数据"),d=j()),_.clear(),b=d.length,t=((c=d[0])==null?void 0:c.length)||0,b===0||t===0){console.warn("数据为空，无法创建热力图");return}let e=1/0,l=-1/0;for(let r=0;r<b;r++){const w=d[r];if(Array.isArray(w))for(let s=0;s<t;s++){const h=w[s];typeof h=="number"&&(h<e&&(e=h),h>l&&(l=h))}}e===1/0&&(e=0),l===-1/0&&(l=0);for(let r=0;r<b;r++){const w=d[r];if(Array.isArray(w))for(let s=0;s<t;s++){const h=w[s],O=Q(r,s,typeof h=="number"?h:0,e,l);_.add(O)}}}function Y(){f=requestAnimationFrame(Y),z.value&&ee(),u&&u.update(),i.render(y,m)}function ee(){for(let a=0;a<b;a++)for(let e=0;e<t;e++)d[a]&&typeof d[a][e]=="number"&&(d[a][e]+=(Math.random()-.5)*.3,d[a][e]=Math.min(20,Math.max(1,d[a][e])))}let L=null;function T(a){if(!x.value)return;const e=x.value.getBoundingClientRect();if(a.clientX<e.left||a.clientX>e.right||a.clientY<e.top||a.clientY>e.bottom){M.value.show=!1;return}L&&cancelAnimationFrame(L),L=requestAnimationFrame(()=>{A.x=(a.clientX-e.left)/e.width*2-1,A.y=-((a.clientY-e.top)/e.height)*2+1,v.setFromCamera(A,m);const l=v.intersectObjects(_.children);if(l.length){const c=l[0].object,{value:r,x:w,z:s}=c.userData;M.value={show:!0,x:a.clientX-e.left+10,y:a.clientY-e.top-30,content:`数值: ${r.toFixed(2)}<br>位置: (${w}, ${s})`}}else M.value.show=!1})}function $(){m.aspect=o.width/o.height,m.updateProjectionMatrix(),i.setSize(o.width,o.height)}return S({refresh:P,toggleAnimation:()=>z.value=!z.value}),(a,e)=>(I(),N("div",{class:"heatmap-wrapper",style:W({width:E.width+"px",height:E.height+"px"})},[D(M).show?(I(),N("div",{key:0,class:"tooltip",style:W({left:D(M).x+"px",top:D(M).y+"px"}),innerHTML:D(M).content},null,12,ze)):le("",!0),K("div",{ref_key:"containerRef",ref:x,class:"three-container"},null,512)],4))}}),Be=ce(De,[["__scopeId","data-v-d7da00a4"]]),Ee={style:{"margin-top":"10px"}},Se=U({name:"JBHeatMap",__name:"BasicsHeatMap",setup(E){const S=B(null);function o(y,m){const i=y*m,u=Math.round(i*.02),_=Math.round(i*.2),v=Math.round(i*.3),A=i-u-_-v;console.log({total:i,"40-50":u,"20-30":_,"10-20":v,"1-5":A});const f=[];for(let t=0;t<u;t++)f.push(Math.floor(Math.random()*11)+40);for(let t=0;t<_;t++)f.push(Math.floor(Math.random()*11)+20);for(let t=0;t<v;t++)f.push(Math.floor(Math.random()*11)+10);for(let t=0;t<A;t++)f.push(Math.floor(Math.random()*5)+1);for(let t=f.length-1;t>0;t--){const C=Math.floor(Math.random()*(t+1));[f[t],f[C]]=[f[C],f[t]]}const d=[];let b=0;for(let t=0;t<y;t++){const C=[];for(let j=0;j<m;j++)C.push(f[b++]);d.push(C)}return d}const x=B(o(50,100));function M(){x.value=o(50,100),S.value.refresh()}function z(){console.log("热力图已刷新")}return(y,m)=>{const i=Be,u=ne;return I(),N("div",null,[q(i,{ref_key:"heatmap3D",ref:S,cameraPosition:{x:18,y:18,z:0},data:D(x),width:"675",height:"475","base-size":"0.5","max-height":"5","auto-animate":!0,onRefresh:z},null,8,["data"]),K("div",Ee,[q(u,{onClick:M},{default:ue(()=>[...m[0]||(m[0]=[fe("刷新热力图数据",-1)])]),_:1})])])}}}),Ve=He(Se);export{Ve as WYHeatMap};
