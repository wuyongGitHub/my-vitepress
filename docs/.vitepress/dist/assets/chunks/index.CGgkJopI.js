import{_ as le,p,a9 as oe,q as W,h as A,v as ne,c as H,o as B,j as u,e as $,a0 as se,t as h,N as G,n as re,P as ue,d as ce,G as ie}from"./framework.Gi3K-aNU.js";import{w as he}from"./tool.D1yyrI_Z.js";const ve={class:"heatmap-container"},fe={class:"coordinates"},de={key:0,class:"controls"},pe={class:"data-info"},me={key:1,class:"legend"},ge={__name:"HeatMap2D",props:{width:{type:Number,default:612},height:{type:Number,default:831},blockWidth:{type:Number,default:36},blockHeight:{type:Number,default:36},refreshTrigger:{type:[Number,String,Boolean],default:null},showControls:{type:Boolean,default:!1},showLegend:{type:Boolean,default:!1},heatmapData:{type:Array,default:()=>[]}},setup(S){const o=S,g=p(o.width?o.width:0),m=p(o.height),v=p(o.blockWidth),f=p(o.blockHeight),_=p(null);let b=null;const c=p(0),d=p(0),i=p([]),z=p(0),T=p(0),r=oe({visible:!1,x:0,y:0,col:0,row:0,value:0,rawX:0,rawY:0});let k=!1,D=!1;const N=[{threshold:.1,color:"#08315f"},{threshold:.2,color:"#4588bb"},{threshold:.3,color:"#85bee3"},{threshold:.4,color:"#bedcf4"},{threshold:.5,color:"#e4d7dc"},{threshold:.6,color:"#fcdfda"},{threshold:.7,color:"#f9b6a2"},{threshold:.8,color:"#f97860"},{threshold:.9,color:"#c81626"},{threshold:1,color:"#af000f"}];W(()=>o.heatmapData,e=>{i.value=e,w()},{deep:!0});function I(e,t){if(t===0)return"transparent";const a=e/t;for(let l of N)if(a<=l.threshold)return l.color;return N[N.length-1].color}const J=A(()=>{var t;let e=0;for(let a=0;a<d.value;a++)for(let l=0;l<c.value;l++)((t=i.value[a])==null?void 0:t[l])>0&&e++;return e}),q=A(()=>{var t;let e=0;for(let a=0;a<d.value;a++)for(let l=0;l<c.value;l++){const n=((t=i.value[a])==null?void 0:t[l])||0;n>e&&(e=n)}return e}),F=A(()=>{var a;let e=0,t=0;for(let l=0;l<d.value;l++)for(let n=0;n<c.value;n++){const s=((a=i.value[l])==null?void 0:a[n])||0;s>0&&(e+=s,t++)}return t>0?e/t:0});function E(){c.value=Math.floor(g.value/v.value),d.value=Math.floor(m.value/f.value)}function K(){i.value=Array(d.value).fill().map(()=>Array(c.value).fill(0))}function w(){var e;if(b){b.clearRect(0,0,g.value,m.value);for(let t=0;t<d.value;t++)for(let a=0;a<c.value;a++){const l=((e=i.value[t])==null?void 0:e[a])||0;if(l>0){const n=a*v.value,s=t*f.value;b.fillStyle=I(l,q.value),b.fillRect(n,s,v.value,f.value)}}}}function j(e,t,a,l){for(let n=0;n<d.value;n++)for(let s=0;s<c.value;s++){const M=s*v.value+v.value/2,Y=n*f.value+f.value/2,C=Math.sqrt((M-e)**2+(Y-t)**2);if(C<a){const R=l*(1-C/a);i.value[n][s]=Math.max(i.value[n][s],Math.floor(R))}}}function X(e,t,a,l){const n=Math.floor(e/v.value),s=Math.floor(t/f.value),M=Math.ceil(a/Math.max(v.value,f.value)),Y=Math.max(0,n-M),C=Math.min(c.value-1,n+M),R=Math.max(0,s-M),te=Math.min(d.value-1,s+M);for(let x=R;x<=te;x++)for(let y=Y;y<=C;y++){const V=Math.sqrt((y-n)**2+(x-s)**2)*Math.max(v.value,f.value);if(V<a){const ae=l*(1-V/a);i.value[x][y]=l===0?0:Math.max(i.value[x][y],Math.floor(ae))}}w()}function P(){for(let e=0;e<d.value;e++)for(let t=0;t<c.value;t++)i.value[e][t]=Math.random()<.1?Math.floor(Math.random()*100):0;w()}function U(){L(),j(.1*g.value,.1*m.value,50,90),j(.3*g.value,.2*m.value,40,80),j(.2*g.value,.5*m.value,60,95),w()}function L(){i.value.forEach(e=>e.fill(0)),w()}function O(e){var M;const t=_.value.getBoundingClientRect(),a=e.clientX-t.left,l=e.clientY-t.top;z.value=Math.floor(a),T.value=Math.floor(l);const n=Math.floor(a/v.value),s=Math.floor(l/f.value);n>=0&&n<c.value&&s>=0&&s<d.value?(r.visible=!0,r.col=n,r.row=s,r.value=((M=i.value[s])==null?void 0:M[n])||0,r.rawX=a,r.rawY=l,r.x=e.clientX+15,r.y=e.clientY-30):r.visible=!1,k&&(D?X(a,l,20,0):X(a,l,15,60))}function Q(e){k=!0,D=e.button===2;const t=_.value.getBoundingClientRect(),a=e.clientX-t.left,l=e.clientY-t.top;X(a,l,D?20:15,D?0:60)}function Z(){k=!1}function ee(){k=!1,r.visible=!1}return ne(()=>{const e=_.value;e.width=o.width,e.height=o.height,b=e.getContext("2d"),E(),o.heatmapData&&o.heatmapData.length>0?i.value=o.heatmapData:K(),w()}),W(()=>[o.width,o.height,o.blockWidth,o.blockHeight],()=>{g.value=o.width,m.value=o.height,v.value=o.blockWidth,f.value=o.blockHeight,ue(()=>{const e=_.value;e&&(e.width=g.value,e.height=m.value,b=e.getContext("2d"),E(),w())})}),W(()=>o.refreshTrigger,()=>{o.refreshTrigger!==null&&w()}),(e,t)=>(B(),H("div",ve,[u("div",{class:"canvas-wrapper",style:G({width:`${g.value}px`,height:`${m.value}px`})},[u("canvas",{ref_key:"heatmapCanvas",ref:_,onMousedown:Q,onMousemove:O,onMouseup:Z,onMouseleave:ee,onContextmenu:t[0]||(t[0]=se(()=>{},["prevent"]))},null,544),u("div",fe,"X: "+h(z.value)+", Y: "+h(T.value),1),u("div",{class:re(["tooltip",{show:r.visible}]),style:G({left:r.x+"px",top:r.y+"px"})},[t[1]||(t[1]=u("h3",null,"热力块信息",-1)),u("p",null,"位置: ("+h(r.col)+", "+h(r.row)+")",1),u("p",null,"值: "+h(r.value),1),u("p",null,"坐标: ("+h(Math.floor(r.rawX))+", "+h(Math.floor(r.rawY))+")",1)],6)],4),o.showControls?(B(),H("div",de,[u("div",pe," 尺寸: "+h(c.value)+" × "+h(d.value)+" (共 "+h(c.value*d.value)+" 块)｜ 活跃块: "+h(J.value)+"｜ 最大值: "+h(q.value)+"｜ 平均值: "+h(F.value.toFixed(2)),1),u("div",{class:"btn-group"},[u("button",{onClick:P},"随机数据"),u("button",{onClick:U},"重置"),u("button",{onClick:L},"清除")])])):$("",!0),o.showLegend?(B(),H("div",me,[...t[2]||(t[2]=[u("div",{class:"color-scale"},null,-1),u("div",{class:"color-labels"},[u("span",null,"低"),u("span",null,"高")],-1)])])):$("",!0)]))}},Me=le(ge,[["__scopeId","data-v-8dafc6e4"]]),we=ce({name:"JBHeatMap2D",__name:"BasicsHeatMap",setup(S){const o=Math.floor(17),g=Math.floor(831/36),m=p(0),v=p(Array.from({length:g},()=>Array.from({length:o},()=>Math.random()<.2?Math.floor(Math.random()*100):0))),f=()=>{m.value+=1};return(_,b)=>{const c=Me;return B(),H("div",null,[ie(c,{heatmapData:v.value,width:612,height:831,"block-width":36,"block-height":36,"refresh-trigger":m.value,"show-controls":!0,"show-legend":!1},null,8,["heatmapData","refresh-trigger"]),u("button",{onClick:f},"刷新热力图")])}}}),ye=he(we);export{ye as JBHeatMap2D};
