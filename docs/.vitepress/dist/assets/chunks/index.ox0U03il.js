import{S as K,O as Y,W as Q,G as Z,E as T,e as ee,M as te,f as ae,g as se,L as ne,h as oe}from"./three.module.C4cygprZ.js";import{t as re,d as A,i as $,w as G}from"./tool.BsbwrfuX.js";import{d as y,p as F,h as le,s as ce,x as ie,c as P,j as _,r as ue,e as de,F as pe,C as he,o as S,N as ve,k,t as q,P as me,_ as C,G as O,K as W,W as N,w as fe}from"./framework.DVkiNd0e.js";const _e={class:"three-pie-container"},ge={class:"three-pie-main"},Pe={class:"pie-value"},Se={class:"pie-label"},be=y({name:"BqPie",__name:"Pie",props:{data:{default:()=>[{value:.6637,label:"TM"},{value:.2171,label:"DOUYIN"},{value:.0764,label:"JD"},{value:.0237,label:"VIP"},{value:.0191,label:"Others"}]},colorList:{default:()=>["#93DBFF","#4B84F0","#FFD982","#00D7FF","#49C384"]},innerRadius:{default:60},outRadius:{default:84},depth:{default:15},centerTooltip:{type:Boolean,default:!0}},setup(M){let l=0;const n=M;let i=["#93DBFF","#4B84F0","#FFD982","#00D7FF","#49C384"];const c=F();let d=null,u=null;const g=new K;let m=null;const V=()=>{var t;if(c.value){const e=((t=c.value)==null?void 0:t.clientWidth)/c.value.clientHeight,s=Math.min(c.value.clientWidth,c.value.clientHeight)/2;m=new Y(-s*e,s*e,s,-s,1,1e3),m.position.set(0,0,686),m.lookAt(g.position),d&&g.remove(d),d=z(),L(),g.add(d),u=new Q({canvas:c.value,antialias:!0,alpha:!0}),u.setSize(c.value.clientWidth,c.value.clientHeight),u.setClearColor(16777215,0),u.setPixelRatio(2),u.render(g,m)}},z=()=>{const t=new Z;return p.value.forEach((e,a)=>{const s=i[a%i.length],o=n.colorList[a%n.colorList.length],f=x(e.startAngle,e.endAngle,s,"sector");t.add(f);const h=x(e.startAngle,e.endAngle,o,"bottomSector");h.renderOrder=999,t.add(h);const v=U(e.startAngle,e.endAngle);t.add(v)}),t},D=le(()=>({curveSegments:40,depth:n.depth,bevelEnabled:!1,bevelSegments:9,steps:2,bevelSize:0,bevelThickness:0})),I=(t,e,a,s)=>{const o=new oe;return o.moveTo(n.outRadius,0),o.absarc(0,0,a,t,e,!0),o.absarc(0,0,s,e,t,!1),o},x=(t,e,a,s)=>{const o=I(t,e,n.innerRadius,n.outRadius),f=A(D.value);let h=.9;s==="bottomSector"&&(h=.6,f.depth=1);const v=new T(o,f),J=new ee({color:a,opacity:h,transparent:!0,depthTest:!0}),b=new te(v,J);return b.position.set(0,0,0),b.renderOrder=2,b.rotateX(-.3611111111111111*Math.PI),b},U=(t,e)=>{const a=I(t,e,n.innerRadius+1,n.outRadius-1),s=A(D.value),o=new T(a,s),f=new ae(o,10),h=new se({fog:!1,color:16777215,emissive:16777215,transparent:!0,opacity:.5,roughness:0}),v=new ne(f,h);return v.rotateX(-.3611111111111111*Math.PI),v.renderOrder=4,v},X=function(){let t=!1;return n.data.length!==n.colorList.length&&(console.warn("颜色和数据长度不匹配"),t=!0),t}(),j=.3*Math.PI*2,r=F(0),p=F([]);let E=0;ce(()=>{if(X)return!1;if(i=n.colorList||i,p.value=A(n.data)||[],p.value.length===0)return;E=p.value.reduce((e,a)=>typeof a.value=="number"?e+a.value:e,0);let t=j;p.value.forEach(e=>{e.startAngle=t,e.endAngle=e.startAngle-e.value/E*Math.PI*2,t=e.endAngle}),me(()=>{V(),B()})});const R=F(0);let w=0;const B=()=>{const t=p.value.length;if((r.value%1>.99||r.value%1<.01)&&w<1){R.value=Math.round(r.value)>=t?0:Math.round(r.value),w+=.01,$&&(l=requestAnimationFrame(B));return}w=0,r.value+=.01,r.value>t&&(r.value=0),L(),m&&(u==null||u.render(g,m)),$&&(l=requestAnimationFrame(B))},L=()=>{const t=p.value.length,e=(r.value+1)*10%(t*10)/10;d==null||d.children.forEach((a,s)=>{if(Math.floor(r.value)===Math.ceil((s-2)/3)){const o=1-r.value%1;a.scale.set(1,1,1+o)}if(Math.floor(e)===Math.ceil((s-2)/3)){const o=r.value%1;a.scale.set(1,1,1+o)}})};return ie(()=>{cancelAnimationFrame(l)}),(t,e)=>(S(),P("div",_e,[_("div",ge,[_("canvas",{ref_key:"pieRef",ref:c,class:"pie-canvas"},null,512),n.centerTooltip?(S(!0),P(pe,{key:0},he(n.data,(a,s)=>(S(),P("div",{key:a.value,class:"pie-info",style:ve({opacity:k(R)===s?1:0})},[_("div",Pe,q(k(re)(a.value)),1),_("div",Se,q(a.label),1)],4))),128)):de("",!0)]),ue(t.$slots,"footer",{},void 0,!0)]))}}),H=C(be,[["__scopeId","data-v-0910c0b8"]]),Fe={class:"basics-pie"},Me=y({name:"BqBasicsPie",__name:"BasicsPie",setup(M){return(l,n)=>{const i=H;return S(),P("div",Fe,[O(i,W(l.$attrs,N(l.$props)),null,16)])}}}),we=C(Me,[["__scopeId","data-v-295bde6d"]]),Be={class:"slot-pie"},Ae="https://tqa.oss-cn-shanghai.aliyuncs.com/val/024af179-9e6d-4ce1-84c6-86a2ddb42ca5.png",ye=y({name:"BqSlotPie",__name:"SlotPie",setup(M){return(l,n)=>{const i=H;return S(),P("div",Be,[O(i,W(l.$attrs,N(l.$props)),{footer:fe(()=>[_("div",{class:"footer"},[_("img",{src:Ae})])]),_:1},16)])}}}),Ce=C(ye,[["__scopeId","data-v-3c1187a7"]]),Ee=G(we),Re=G(Ce);export{Ee as BqBasicsPie,Re as BqSlotPie};
