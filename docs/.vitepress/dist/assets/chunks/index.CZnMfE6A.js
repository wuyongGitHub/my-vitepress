const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/OrbitControls.DfyDYf8j.js","assets/chunks/three.module.CjLKN4l_.js"])))=>i.map(i=>d[i]);
import{_ as re}from"./Button.B7dY0lcR.js";import{d as K,p as E,v as se,V as ie,x as le,c as I,o as P,N as q,e as ce,j as Q,k as B,_ as ue,G as J,w as fe,a as de}from"./framework.Gi3K-aNU.js";import{S as pe,e as H,P as me,W as he,f as ye,D as ge,G as we,g as _e,h as be,R as xe,i as Me,O as ve,j as Ae,c as Ce,k as He,M as U}from"./three.module.CjLKN4l_.js";import{w as ze}from"./tool.D1yyrI_Z.js";const De=["innerHTML"],Be=K({name:"JBHeatMap3D",__name:"HeatMap",props:{data:{type:Array,default:()=>[]},width:{type:Number,default:600},height:{type:Number,default:500},baseSize:{type:Number,default:.1},maxHeight:{type:Number,default:3},enableOrbit:{type:Boolean,default:!0},backgroundColor:{type:String,default:"#0d1b2a"},showGridHelper:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},gradientColors:{type:Array,default:()=>["#9b30ff","#00ffff","#ffff00","#ff0000"]},autoAnimate:{type:Boolean,default:!1},cameraPosition:{type:Object,default:()=>({x:5,y:5,z:5})}},setup(S,{expose:j}){const o=S,x=E(null),M=E({show:!1,x:0,y:0,content:""}),z=E(o.autoAnimate);let y,m,i,u=null,g,v,A,f=null,d=[],b=0,t=0;se(async()=>{const{OrbitControls:a}=await ie(async()=>{const{OrbitControls:e}=await import("./OrbitControls.DfyDYf8j.js");return{OrbitControls:e}},__vite__mapDeps([0,1]));C(),o.enableOrbit&&(u=new a(m,i.domElement),u.enableDamping=!0,u.dampingFactor=.05),T(),window.addEventListener("mousemove",$),window.addEventListener("resize",X),x.value&&x.value.addEventListener("mouseleave",()=>{M.value.show=!1})}),le(()=>{f&&cancelAnimationFrame(f),window.removeEventListener("mousemove",$),window.removeEventListener("resize",X),i.dispose()});function C(){const{backgroundColor:a,showGridHelper:e,showAxesHelper:l,cameraPosition:c}=o;y=new pe,y.background=new H(a),m=new me(75,o.width/o.height,.1,1e3),m.position.set(c.x,c.y,c.z),i=new he({antialias:!0}),i.setSize(o.width,o.height),i.shadowMap.enabled=!0,x.value&&x.value.appendChild(i.domElement),o.enableOrbit&&u&&(u.enableDamping=!0,u.dampingFactor=.05),y.add(new ye(16777215,.6));const r=new ge(16777215,.8);if(r.position.set(10,20,5),y.add(r),g=new we,y.add(g),e){const w=Math.max(b,t)*o.baseSize*1.2,s=new _e(w,Math.max(b,t),4473924,2236962);y.add(s)}if(l){const w=new be(Math.max(b,t)*o.baseSize*.6);y.add(w)}v=new xe,A=new Me,Y()}function G(a=10,e=10){return Array.from({length:a},()=>Array.from({length:e},()=>Math.random()*15+1))}function Z(a,e,l,c,r,w){const s=.1+(l-c)/(r-c)*o.maxHeight,h=new Ae(o.baseSize,s,o.baseSize,1,8,1),O=h.attributes.position,R=h.attributes.normal,W=[],F=(l-c)/(r-c),k=[new H(139),new H(65535),new H(16776960),new H(16711680)];let n=[];F>=.75?n=[...k]:F>=.5?n=k.slice(0,3):F>=.25?n=k.slice(0,2):n=k.slice(0,1);for(let L=0;L<O.count;L++){const oe=O.getY(L),ne=R.getY(L);let p=new H;const _=(oe+s/2)/s;ne>.5?p.copy(n[n.length-1]):n.length===4?_<.25?p.lerpColors(n[0],n[1],_/.25):_<.5?p.lerpColors(n[1],n[2],(_-.25)/.25):_<.75?p.lerpColors(n[2],n[3],(_-.5)/.25):p.copy(n[3]):n.length===3?_<.33?p.lerpColors(n[0],n[1],_/.33):_<.66?p.lerpColors(n[1],n[2],(_-.33)/.33):p.copy(n[2]):n.length===2?_<.5?p.lerpColors(n[0],n[1],_/.5):p.copy(n[1]):p.copy(n[0]),W.push(p.r,p.g,p.b)}h.setAttribute("color",new Ce(new Float32Array(W),3));const ae=new He({vertexColors:!0}),N=new U(h,ae);return N.position.set((a-(b-1)/2)*o.baseSize,s/2,(e-(t-1)/2)*o.baseSize),N.userData={value:l,x:a,z:e},N}let D=null;new ve;function ee(){if(D)D.geometry.dispose(),D.material.dispose(),g.remove(D),D=null;else{const{children:a}=g;a.forEach(e=>{e instanceof U&&(e.geometry.dispose(),(Array.isArray(e.material)?e.material:[e.material]).forEach(c=>c.dispose()))}),g.clear()}}function Y(){var c;if(ee(),console.log("createHeatmap 调用，props.data =",o.data),Array.isArray(o.data)&&o.data.length>0&&o.data.every(r=>Array.isArray(r))?d=o.data:(console.log("数据不合法，使用默认数据"),d=G()),g.clear(),b=d.length,t=((c=d[0])==null?void 0:c.length)||0,b===0||t===0){console.warn("数据为空，无法创建热力图");return}let e=1/0,l=-1/0;for(let r=0;r<b;r++){const w=d[r];if(Array.isArray(w))for(let s=0;s<t;s++){const h=w[s];typeof h=="number"&&(h<e&&(e=h),h>l&&(l=h))}}e===1/0&&(e=0),l===-1/0&&(l=0);for(let r=0;r<b;r++){const w=d[r];if(Array.isArray(w))for(let s=0;s<t;s++){const h=w[s],R=Z(r,s,typeof h=="number"?h:0,e,l);g.add(R)}}}function T(){f=requestAnimationFrame(T),z.value&&te(),u&&u.update(),i.render(y,m)}function te(){for(let a=0;a<b;a++)for(let e=0;e<t;e++)d[a]&&typeof d[a][e]=="number"&&(d[a][e]+=(Math.random()-.5)*.3,d[a][e]=Math.min(20,Math.max(1,d[a][e])))}let V=null;function $(a){if(!x.value)return;const e=x.value.getBoundingClientRect();if(a.clientX<e.left||a.clientX>e.right||a.clientY<e.top||a.clientY>e.bottom){M.value.show=!1;return}V&&cancelAnimationFrame(V),V=requestAnimationFrame(()=>{A.x=(a.clientX-e.left)/e.width*2-1,A.y=-((a.clientY-e.top)/e.height)*2+1,v.setFromCamera(A,m);const l=v.intersectObjects(g.children);if(l.length){const c=l[0].object,{value:r,x:w,z:s}=c.userData;M.value={show:!0,x:a.clientX-e.left+10,y:a.clientY-e.top-30,content:`数值: ${r.toFixed(2)}<br>位置: (${w}, ${s})`}}else M.value.show=!1})}function X(){m.aspect=o.width/o.height,m.updateProjectionMatrix(),i.setSize(o.width,o.height)}return j({refresh:Y,toggleAnimation:()=>z.value=!z.value}),(a,e)=>(P(),I("div",{class:"heatmap-wrapper",style:q({width:S.width+"px",height:S.height+"px"})},[B(M).show?(P(),I("div",{key:0,class:"tooltip",style:q({left:B(M).x+"px",top:B(M).y+"px"}),innerHTML:B(M).content},null,12,De)):ce("",!0),Q("div",{ref_key:"containerRef",ref:x,class:"three-container"},null,512)],4))}}),Ee=ue(Be,[["__scopeId","data-v-61d3439e"]]),Se={style:{"margin-top":"10px"}},je=K({name:"JBHeatMap",__name:"BasicsHeatMap",setup(S){const j=E(null);function o(y,m){const i=y*m,u=Math.round(i*.02),g=Math.round(i*.2),v=Math.round(i*.3),A=i-u-g-v;console.log({total:i,"40-50":u,"20-30":g,"10-20":v,"1-5":A});const f=[];for(let t=0;t<u;t++)f.push(Math.floor(Math.random()*11)+40);for(let t=0;t<g;t++)f.push(Math.floor(Math.random()*11)+20);for(let t=0;t<v;t++)f.push(Math.floor(Math.random()*11)+10);for(let t=0;t<A;t++)f.push(Math.floor(Math.random()*5)+1);for(let t=f.length-1;t>0;t--){const C=Math.floor(Math.random()*(t+1));[f[t],f[C]]=[f[C],f[t]]}const d=[];let b=0;for(let t=0;t<y;t++){const C=[];for(let G=0;G<m;G++)C.push(f[b++]);d.push(C)}return d}const x=E(o(50,100));function M(){x.value=o(50,100),j.value.refresh()}function z(){console.log("热力图已刷新")}return(y,m)=>{const i=Ee,u=re;return P(),I("div",null,[J(i,{ref_key:"heatmap3D",ref:j,cameraPosition:{x:18,y:18,z:0},data:B(x),width:"675",height:"475","base-size":"0.5","max-height":"5","auto-animate":!0,onRefresh:z},null,8,["data"]),Q("div",Se,[J(u,{onClick:M},{default:fe(()=>[...m[0]||(m[0]=[de("刷新热力图数据",-1)])]),_:1})])])}}}),Oe=ze(je);export{Oe as WYHeatMap};
