const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/OrbitControls.DfyDYf8j.js","assets/chunks/three.module.CjLKN4l_.js"])))=>i.map(i=>d[i]);
import{_ as le}from"./Button.B7dY0lcR.js";import{d as ee,p as D,v as ce,V as ue,x as fe,c as P,e as de,j as te,k as j,N as K,o as T,_ as me,G as Q,w as pe,a as he}from"./framework.Gi3K-aNU.js";import{S as we,e as _,P as ye,W as ge,f as _e,D as be,G as xe,g as Me,h as ve,O as Ae,R as He,i as Ce,j as ze,c as Se,k as Be,M as Z}from"./three.module.CjLKN4l_.js";import{w as De}from"./tool.D1yyrI_Z.js";const Ee=["innerHTML"],Ge=ee({name:"JBHeatMap3D",__name:"HeatMap",props:{data:{type:Array,default:()=>[]},width:{type:Number,default:600},height:{type:Number,default:500},baseSize:{type:Number,default:.1},maxHeight:{type:Number,default:3},enableOrbit:{type:Boolean,default:!0},backgroundColor:{type:String,default:"#0d1b2a"},showGridHelper:{type:Boolean,default:!0},showAxesHelper:{type:Boolean,default:!0},isStandardColor:{type:Boolean,default:!0},rotateAnimation:{type:Boolean,default:!1},rotationSpeed:{type:Number,default:.01},gradientColors:{type:Array,default:()=>["#9b30ff","#00ffff","#ffff00","#ff0000"]},autoAnimate:{type:Boolean,default:!1},cameraPosition:{type:Object,default:()=>({x:5,y:5,z:5})}},setup(k,{expose:V}){const E=D(0),t=k,M=D(null),b=D({show:!1,x:0,y:0,content:""}),z=D(t.autoAnimate);let f,l,d,w=null,y,S,c,B=null,H=[],a=0,m=0;ce(async()=>{const{OrbitControls:n}=await ue(async()=>{const{OrbitControls:e}=await import("./OrbitControls.DfyDYf8j.js");return{OrbitControls:e}},__vite__mapDeps([0,1]));N(),t.enableOrbit&&(w=new n(l,d.domElement),w.enableDamping=!0,w.dampingFactor=.05),X(),window.addEventListener("mousemove",W),window.addEventListener("resize",q),M.value&&M.value.addEventListener("mouseleave",()=>{b.value.show=!1})}),fe(()=>{B&&cancelAnimationFrame(B),window.removeEventListener("mousemove",W),window.removeEventListener("resize",q),d.dispose()});function N(){const{backgroundColor:n,showGridHelper:e,showAxesHelper:s,cameraPosition:u}=t;f=new we,f.background=new _(n),l=new ye(75,t.width/t.height,.1,1e3),l.position.set(u.x,u.y,u.z),d=new ge({antialias:!0}),d.setSize(t.width,t.height),d.shadowMap.enabled=!0,M.value&&M.value.appendChild(d.domElement),t.enableOrbit&&w&&(w.enableDamping=!0,w.dampingFactor=.05),f.add(new _e(16777215,.6));const o=new be(16777215,.8);if(o.position.set(10,20,5),f.add(o),y=new xe,f.add(y),e){const g=Math.max(a,m)*t.baseSize*1.2,r=new Me(g,Math.max(a,m),4473924,2236962);f.add(r)}if(s){const g=new ve(Math.max(a,m)*t.baseSize*.6);f.add(g)}S=new He,c=new Ce,$()}function ae(n=10,e=10){return Array.from({length:n},()=>Array.from({length:e},()=>Math.random()*15+1))}function Y(n,e,s,u,o,g){const r=.1+(s-u)/(o-u)*t.maxHeight,p=new ze(t.baseSize,r,t.baseSize,1,8,1),G=p.attributes.position,L=p.attributes.normal,J=[],v=(s-u)/(o-u),x=[new _(536927),new _(4556987),new _(8765155),new _(12508404),new _(14997468),new _(16572378),new _(16365218),new _(16349280),new _(13112870),new _(11468815)];let i=[],h=0;v>=.9?(h=10,i=x.slice(0,10)):v>=.8?(h=9,i=x.slice(0,9)):v>=.7?(h=8,i=x.slice(0,8)):v>=.6?(h=7,i=x.slice(0,7)):v>=.5?(h=6,i=x.slice(0,6)):v>=.4?(h=5,i=x.slice(0,5)):v>=.3?(h=4,i=x.slice(0,4)):v>=.2?(h=3,i=x.slice(0,3)):v>=.1?(h=2,i=x.slice(0,2)):(h=1,i=x.slice(0,1));for(let O=0;O<G.count;O++){const re=G.getY(O),ie=L.getY(O);let C=new _;const U=Math.max(0,Math.min(1,(re+r/2)/r));if(ie>.5)C.copy(i[i.length-1]);else if(h===1)C.copy(i[0]);else{const I=1/(h-1);let A=Math.floor(U/I);A=Math.min(A,h-2),A=Math.max(0,A);const se=(U-A*I)/I;A>=0&&A+1<i.length?C.lerpColors(i[A],i[A+1],se):C.copy(i[i.length-1])}J.push(C.r,C.g,C.b)}p.setAttribute("color",new Se(new Float32Array(J),3));const oe=new Be({vertexColors:!0}),F=new Z(p,oe);return F.position.set((n-(a-1)/2)*t.baseSize,r/2,(e-(m-1)/2)*t.baseSize),F.userData={value:s,x:n,z:e},F}new Ae;function ne(){{const{children:n}=y;n.forEach(e=>{e instanceof Z&&(e.geometry.dispose(),(Array.isArray(e.material)?e.material:[e.material]).forEach(u=>u.dispose()))}),y.clear()}}function $(){var u;if(ne(),Array.isArray(t.data)&&t.data.length>0&&t.data.every(o=>Array.isArray(o))?H=t.data.map(o=>[...o]):(console.log("数据不合法，使用默认数据"),H=ae()),y.clear(),a=H.length,m=((u=H[0])==null?void 0:u.length)||0,a===0||m===0){console.warn("数据为空，无法创建热力图");return}let e=1/0,s=-1/0;for(let o=0;o<a;o++){const g=H[o];if(Array.isArray(g))for(let r=0;r<m;r++){const p=g[r];typeof p=="number"&&(p<e&&(e=p),p>s&&(s=p))}}e===1/0&&(e=0),s===-1/0&&(s=0);for(let o=0;o<a;o++){const g=H[o];if(Array.isArray(g))for(let r=0;r<m;r++){const p=g[r],G=typeof p=="number"?p:0;let L=null;t.isStandardColor,L=Y(o,r,G,e,s),y.add(L)}}}function X(){B=requestAnimationFrame(X),t.rotateAnimation&&(E.value+=t.rotationSpeed,y.rotation.y=E.value),w&&w.update(),d.render(f,l)}let R=null;function W(n){if(!M.value)return;const e=M.value.getBoundingClientRect();if(n.clientX<e.left||n.clientX>e.right||n.clientY<e.top||n.clientY>e.bottom){b.value.show=!1;return}R&&cancelAnimationFrame(R),R=requestAnimationFrame(()=>{c.x=(n.clientX-e.left)/e.width*2-1,c.y=-((n.clientY-e.top)/e.height)*2+1,S.setFromCamera(c,l);const s=S.intersectObjects(y.children);if(s.length){const u=s[0].object,{value:o,x:g,z:r}=u.userData;b.value={show:!0,x:n.clientX-e.left+10,y:n.clientY-e.top-30,content:`数值: ${o.toFixed(2)}<br>位置: (${g}, ${r})`}}else b.value.show=!1})}function q(){l.aspect=t.width/t.height,l.updateProjectionMatrix(),d.setSize(t.width,t.height)}return V({refresh:$,toggleAnimation:()=>z.value=!z.value}),(n,e)=>(T(),P("div",{class:"heatmap-wrapper",style:K({width:k.width+"px",height:k.height+"px"})},[j(b).show?(T(),P("div",{key:0,class:"tooltip",style:K({left:j(b).x+"px",top:j(b).y+"px"}),innerHTML:j(b).content},null,12,Ee)):de("",!0),te("div",{ref_key:"containerRef",ref:M,class:"three-container"},null,512)],4))}}),Le=me(Ge,[["__scopeId","data-v-7e478b4c"]]),je={style:{"margin-top":"10px"}},ke=ee({name:"JBHeatMap",__name:"BasicsHeatMap",setup(k){const V=D(null);function E(z,f){const l=z*f,d=Math.round(l*.02),w=Math.round(l*.2),y=Math.round(l*.3),S=l-d-w-y;console.log({total:l,"40-50":d,"20-30":w,"10-20":y,"1-5":S});const c=[];for(let a=0;a<d;a++)c.push(Math.floor(Math.random()*11)+40);for(let a=0;a<w;a++)c.push(Math.floor(Math.random()*11)+20);for(let a=0;a<y;a++)c.push(Math.floor(Math.random()*11)+10);for(let a=0;a<S;a++)c.push(Math.floor(Math.random()*5)+1);for(let a=c.length-1;a>0;a--){const m=Math.floor(Math.random()*(a+1));[c[a],c[m]]=[c[m],c[a]]}const B=[];let H=0;for(let a=0;a<z;a++){const m=[];for(let N=0;N<f;N++)m.push(c[H++]);B.push(m)}return B}const t=D(E(50,100));function M(){t.value=E(50,100),V.value.refresh()}function b(){console.log("热力图已刷新")}return(z,f)=>{const l=Le,d=le;return T(),P("div",null,[Q(l,{ref_key:"heatmap3D",ref:V,cameraPosition:{x:18,y:18,z:0},data:j(t),width:"675",height:"475","base-size":"0.5","max-height":"5","auto-animate":!0,onRefresh:b},null,8,["data"]),te("div",je,[Q(d,{onClick:M},{default:pe(()=>[...f[0]||(f[0]=[he("刷新热力图数据",-1)])]),_:1})])])}}}),Fe=De(ke);export{Fe as WYHeatMap};
