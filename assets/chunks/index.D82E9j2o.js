import{_ as ee,p,a9 as te,q as X,h as Y,v as ae,c as D,o as C,j as c,e as L,a0 as le,t as h,N as $,n as oe,P as ne,d as se,G as re}from"./framework.Gi3K-aNU.js";import{w as ce}from"./tool.D1yyrI_Z.js";const ue={class:"heatmap-container"},ie={class:"coordinates"},he={key:0,class:"controls"},ve={class:"data-info"},fe={key:1,class:"legend"},de=Object.assign({name:"HeatMap2D"},{__name:"HeatMap2D",props:{width:{type:Number,default:612},height:{type:Number,default:831},blockWidth:{type:Number,default:36},blockHeight:{type:Number,default:36},refreshTrigger:{type:[Number,String,Boolean],default:null},showControls:{type:Boolean,default:!1},showLegend:{type:Boolean,default:!1},heatmapData:{type:Array,default:()=>[]}},setup(R){const o=R,g=p(o.width?o.width:0),m=p(o.height),v=p(o.blockWidth),f=p(o.blockHeight),_=p(null);let b=null;const u=p(0),d=p(0),i=p([]),W=p(0),A=p(0),r=te({visible:!1,x:0,y:0,col:0,row:0,value:0,rawX:0,rawY:0});let S=!1;const H=[{threshold:.1,color:"#08315f"},{threshold:.2,color:"#4588bb"},{threshold:.3,color:"#85bee3"},{threshold:.4,color:"#bedcf4"},{threshold:.5,color:"#e4d7dc"},{threshold:.6,color:"#fcdfda"},{threshold:.7,color:"#f9b6a2"},{threshold:.8,color:"#f97860"},{threshold:.9,color:"#c81626"},{threshold:1,color:"#af000f"}];X(()=>o.heatmapData,e=>{i.value=e,w()},{deep:!0});function E(e,t){if(t===0)return"transparent";const a=e/t;for(let l of H)if(a<=l.threshold)return l.color;return H[H.length-1].color}const G=Y(()=>{var t;let e=0;for(let a=0;a<d.value;a++)for(let l=0;l<u.value;l++)((t=i.value[a])==null?void 0:t[l])>0&&e++;return e}),z=Y(()=>{var t;let e=0;for(let a=0;a<d.value;a++)for(let l=0;l<u.value;l++){const n=((t=i.value[a])==null?void 0:t[l])||0;n>e&&(e=n)}return e}),I=Y(()=>{var a;let e=0,t=0;for(let l=0;l<d.value;l++)for(let n=0;n<u.value;n++){const s=((a=i.value[l])==null?void 0:a[n])||0;s>0&&(e+=s,t++)}return t>0?e/t:0});function T(){u.value=Math.ceil(g.value/v.value),d.value=Math.ceil(m.value/f.value)}function J(){i.value=Array(d.value).fill().map(()=>Array(u.value).fill(0))}function w(){var e;if(b){b.clearRect(0,0,g.value,m.value);for(let t=0;t<d.value;t++)for(let a=0;a<u.value;a++){const l=((e=i.value[t])==null?void 0:e[a])||0;if(l>0){const n=a*v.value,s=t*f.value;b.fillStyle=E(l,z.value),b.fillRect(n,s,v.value,f.value)}}}}function B(e,t,a,l){for(let n=0;n<d.value;n++)for(let s=0;s<u.value;s++){const M=s*v.value+v.value/2,j=n*f.value+f.value/2,k=Math.sqrt((M-e)**2+(j-t)**2);if(k<a){const N=l*(1-k/a);i.value[n][s]=Math.max(i.value[n][s],Math.floor(N))}}}function F(e,t,a,l){const n=Math.floor(e/v.value),s=Math.floor(t/f.value),M=Math.ceil(a/Math.max(v.value,f.value)),j=Math.max(0,n-M),k=Math.min(u.value-1,n+M),N=Math.max(0,s-M),U=Math.min(d.value-1,s+M);for(let y=N;y<=U;y++)for(let x=j;x<=k;x++){const q=Math.sqrt((x-n)**2+(y-s)**2)*Math.max(v.value,f.value);if(q<a){const Z=l*(1-q/a);i.value[y][x]=Math.max(i.value[y][x],Math.floor(Z))}}w()}function K(){for(let e=0;e<d.value;e++)for(let t=0;t<u.value;t++)i.value[e][t]=Math.random()<.1?Math.floor(Math.random()*100):0;w()}function O(){V(),B(.1*g.value,.1*m.value,50,90),B(.3*g.value,.2*m.value,40,80),B(.2*g.value,.5*m.value,60,95),w()}function V(){i.value.forEach(e=>e.fill(0)),w()}function P(e){var M;const t=_.value.getBoundingClientRect(),a=e.clientX-t.left,l=e.clientY-t.top;W.value=Math.floor(a),A.value=Math.floor(l);const n=Math.floor(a/v.value),s=Math.floor(l/f.value);n>=0&&n<u.value&&s>=0&&s<d.value?(r.visible=!0,r.col=n,r.row=s,r.value=((M=i.value[s])==null?void 0:M[n])||0,r.rawX=a,r.rawY=l,r.x=e.clientX+15,r.y=e.clientY-30):r.visible=!1,S&&F(a,l,15,60)}function Q(){S=!1,r.visible=!1}return ae(()=>{const e=_.value;e.width=o.width,e.height=o.height,b=e.getContext("2d"),T(),o.heatmapData&&o.heatmapData.length>0?i.value=o.heatmapData:J(),w()}),X(()=>[o.width,o.height,o.blockWidth,o.blockHeight],()=>{g.value=o.width,m.value=o.height,v.value=o.blockWidth,f.value=o.blockHeight,ne(()=>{const e=_.value;e&&(e.width=g.value,e.height=m.value,b=e.getContext("2d"),T(),w())})}),X(()=>o.refreshTrigger,()=>{o.refreshTrigger!==null&&w()}),(e,t)=>(C(),D("div",ue,[c("div",{class:"canvas-wrapper",style:$({width:`${g.value}px`,height:`${m.value}px`})},[c("canvas",{ref_key:"heatmapCanvas",ref:_,onMousemove:P,onMouseleave:Q,onContextmenu:t[0]||(t[0]=le(()=>{},["prevent"]))},null,544),c("div",ie,"X: "+h(W.value)+", Y: "+h(A.value),1),c("div",{class:oe(["tooltip",{show:r.visible}]),style:$({left:r.x+"px",top:r.y+"px"})},[t[1]||(t[1]=c("h3",null,"热力块信息",-1)),c("p",null,"位置: ("+h(r.col)+", "+h(r.row)+")",1),c("p",null,"值: "+h(r.value),1),c("p",null,"坐标: ("+h(Math.floor(r.rawX))+", "+h(Math.floor(r.rawY))+")",1)],6)],4),o.showControls?(C(),D("div",he,[c("div",ve," 尺寸: "+h(u.value)+" × "+h(d.value)+" (共 "+h(u.value*d.value)+" 块)｜ 活跃块: "+h(G.value)+"｜ 最大值: "+h(z.value)+"｜ 平均值: "+h(I.value.toFixed(2)),1),c("div",{class:"btn-group"},[c("button",{onClick:K},"随机数据"),c("button",{onClick:O},"重置"),c("button",{onClick:V},"清除")])])):L("",!0),o.showLegend?(C(),D("div",fe,[...t[2]||(t[2]=[c("div",{class:"color-scale"},null,-1),c("div",{class:"color-labels"},[c("span",null,"低"),c("span",null,"高")],-1)])])):L("",!0)]))}}),pe=ee(de,[["__scopeId","data-v-8a745770"]]),me=se({name:"JBHeatMap2D",__name:"BasicsHeatMap",setup(R){const o=Math.floor(17),g=Math.floor(831/36),m=p(0),v=p(Array.from({length:g},()=>Array.from({length:o},()=>Math.random()<.2?Math.floor(Math.random()*100):0))),f=()=>{m.value+=1};return(_,b)=>{const u=pe;return C(),D("div",null,[re(u,{heatmapData:v.value,width:612,height:831,"block-width":36,"block-height":36,"refresh-trigger":m.value,"show-controls":!0,"show-legend":!1},null,8,["heatmapData","refresh-trigger"]),c("button",{onClick:f},"刷新热力图")])}}}),be=ce(me);export{be as JBHeatMap2D};
