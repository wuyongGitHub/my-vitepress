import{d as Y,p as r,v as P,q as S,c as g,j as o,e as I,k as _,N as W,t as k,o as m,_ as J,G as j}from"./framework.Gi3K-aNU.js";import{w as q}from"./tool.D1yyrI_Z.js";const z={class:"defect-annotation-viewer"},G=["width","height"],H={key:0,class:"loading-overlay"},M={key:0,class:"legend"},K={class:"legend-item"},O={class:"legend-item"},Q={key:1,class:"status"},Z=Y({name:"ImageAnnotationView",__name:"ImageAnnotationView",props:{imageUrl:{},titleData:{default:()=>[]},shapeData:{default:()=>[]},width:{default:692},height:{default:735},showLegend:{type:Boolean,default:!0},showStatus:{type:Boolean,default:!0},titleLabel:{default:"文字标注"},shapeLabel:{default:"形状标注"}},setup(c,{expose:y}){const e=c,d=r(null),t=r(null),n=new Image,h=r(!1),i=r("等待加载图片..."),p=e.width,w=e.height;let u=1,f=0,v=0;P(()=>{d.value&&(t.value=d.value.getContext("2d")),D()});function U(){h.value=!0,i.value="正在加载图片..."}function A(){h.value=!1}function X(l){u=1,f=(p-l.width)/2,v=(w-l.height)/2}function B(){!t.value||!n.complete||(t.value.clearRect(0,0,p,w),t.value.drawImage(n,f,v,n.width*u,n.height*u))}function D(){if(!e.imageUrl){i.value="缺少图片 URL";return}U(),n.src=e.imageUrl,n.onload=()=>{X(n),B(),A(),i.value="图片加载完成",b()},n.onerror=()=>{A(),i.value="图片加载失败"}}function C(){!t.value||!e.titleData.length||(t.value.font="14px Arial",t.value.fillStyle="#2ecc71",t.value.textBaseline="middle",e.titleData.forEach(l=>{const a=f+l.x*u,s=v+l.y*u,x=s<10?s+15:s;t.value&&t.value.fillText(l.title||"",a,x)}))}function F(){!t.value||!e.shapeData.length||(t.value.strokeStyle="#e74c3c",t.value.lineWidth=2,e.shapeData.forEach(l=>{const a=f+l.leftTopX*u,s=v+l.leftTopY*u,x=f+l.rightBottomX*u,$=v+l.rightBottomY*u,R=x-a,V=$-s;if(t.value&&t.value.strokeRect(a,s,R,V),t.value){const T=s-20<0?s+V+5:s-20,L=`瑕疵 (${a.toFixed(0)},${s.toFixed(0)}),(${x.toFixed(0)},${$.toFixed(0)})`,E=t.value.measureText(L).width;t.value.fillStyle="rgba(255, 255, 255, 0.8)",t.value.fillRect(a,T-18,E+10,18),t.value.fillStyle="#e74c3c",t.value.font="12px Arial",t.value.fillText(L,a+5,T)}}))}function b(){if(!t.value){i.value="Canvas 上下文未初始化";return}B(),C(),F(),i.value=`标注已刷新 - 文字: ${e.titleData.length}, 形状: ${e.shapeData.length}`}function N(){B(),i.value="视图已重置"}return S(()=>[e.titleData,e.shapeData],()=>{console.log("Data changed, refreshing annotations..."),b()},{deep:!0}),S(()=>e.imageUrl,()=>{console.log("imageUrl changed:",e.imageUrl),D()}),y({refreshAnnotations:b,resetView:N}),(l,a)=>(m(),g("div",z,[o("div",{class:"canvas-container",style:W({width:_(p)+"px",height:_(w)+"px"})},[o("canvas",{ref_key:"canvas",ref:d,width:_(p),height:_(w)},null,8,G),h.value?(m(),g("div",H,[...a[0]||(a[0]=[o("div",{class:"spinner"},null,-1)])])):I("",!0)],4),c.showLegend?(m(),g("div",M,[o("div",K,[a[1]||(a[1]=o("div",{class:"color-box title-annotation"},null,-1)),o("span",null,k(c.titleLabel),1)]),o("div",O,[a[2]||(a[2]=o("div",{class:"color-box shape-annotation"},null,-1)),o("span",null,k(c.shapeLabel),1)])])):I("",!0),c.showStatus?(m(),g("div",Q,k(i.value),1)):I("",!0)]))}}),tt=J(Z,[["__scopeId","data-v-b0433361"]]),et={style:{"margin-top":"20px","text-align":"center"}},at="https://picsum.photos/800/600",nt=Y({name:"JBImageAnnotationView",__name:"BasicsImageAnnotationView",setup(c){const y=r([{x:0,y:100,title:"第1张样本"},{x:0,y:200,title:"第2张样本"}]),e=r([{leftTopX:300,leftTopY:400,rightBottomX:350,rightBottomY:450},{leftTopX:100,leftTopY:200,rightBottomX:150,rightBottomY:250}]),d=r(null);return(t,n)=>{const h=tt;return m(),g("div",null,[j(h,{ref_key:"viewer",ref:d,"image-url":at,"title-data":y.value,"shape-data":e.value,width:800,height:600,"show-legend":"","show-status":"","title-label":"样本位置","shape-label":"瑕疵区域"},null,8,["title-data","shape-data"]),o("div",et,[o("button",{onClick:n[0]||(n[0]=i=>t.$refs.viewer.refreshAnnotations())},"刷新标注"),o("button",{onClick:n[1]||(n[1]=i=>t.$refs.viewer.resetView())},"重置视图")])])}}}),it=q(nt);export{it as JBImageAnnotationView};
